- name: Dig DNS CNAME record
  debug:
    msg: "{{ lookup('dig', item.src_hostname, 'qtype=CNAME') }}"
  register: dig
  loop: "{{ nginx_proxies }}"

- name: Fail if DNS record points to alias.zeit.co.
  fail:
    msg: DNS record points to default alias.
  when: item.msg == 'alias.zeit.co.'
  loop: "{{ dig.results }}"

- name: Fail if DNS record points to cname.vercel-dns.com.
  fail:
    msg: DNS record points to default alias.
  when: item.msg == 'cname.vercel-dns.com.'
  loop: "{{ dig.results }}"
