- name: Dig src DNS record
  debug:
    msg: "{{ lookup('dig', item.src_hostname) }}"
  loop: "{{ nginx_proxies }}"
  register: dig_src

- name: Dig host DNS record
  debug:
    msg: "{{ lookup('dig', ansible_host) }}"
  register: dig_host

- name: Fail if src IP is not resolved correctly 
  fail:
    msg: "DNS record for {{ item.item.src_hostname }} does not point to proxy host."
  when: item.msg != dig_host.msg
  loop: "{{ dig_src.results }}"