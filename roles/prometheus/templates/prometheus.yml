scrape_configs:
- job_name: prometheus
  scrape_interval: 10s
  static_configs:
  - targets: 
    - localhost:9090
- job_name: cadvisor
  metrics_path: '/cadvisor/metrics'
  scrape_interval: 10s
  honor_labels: true
  scheme: https
  basic_auth:
    username: "{{ prometheus_cadvisor_basic_auth_username }}"
    password: "{{ prometheus_cadvisor_basic_auth_password }}"
  static_configs:
  - targets:
{% for target in targets %}
{% if target.cadvisor_image is defined %}
    - {{ target.ansible_host }}
{% endif %}
{% endfor %}
- job_name: node-exporter
  metrics_path: '/node-exporter/metrics'
  scrape_interval: 10s
  honor_labels: true
  scheme: https
  basic_auth:
    username: "{{ prometheus_node_exporter_basic_auth_username }}"
    password: "{{ prometheus_node_exporter_basic_auth_password }}"
  static_configs:
  - targets:
{% for target in targets %}
{% if target.node_exporter_image is defined %}
    - {{ target.ansible_host }}
{% endif %}
{% endfor %}